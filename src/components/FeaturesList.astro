---
import PhoneMockup from './PhoneMockup.astro';
---
<section class="features-list">
    
    <!-- 1. Home Dashboard -->
    <div class="feature-item fade-up">
        <div class="container feature-grid">
            <div class="text">
                <span class="step-num">01</span>
                <h2 class="text-title">لوحة تحكم شاملة</h2>
                <p>كل ما تحتاجه في شاشة واحدة. مواعيدك القادمة، تنبيهات الأدوية، والوصول السريع لخدمات الرعاية الصحية.</p>
            </div>
            <div class="image">
                <PhoneMockup src="/images/raw/home.png" alt="لوحة التحكم الرئيسية" />
            </div>
        </div>
    </div>

    <!-- 2. Search Doctor (Dual: Map + List) -->
    <div class="feature-item alt-bg fade-up">
        <div class="container feature-grid reverse">
            <div class="text">
                <span class="step-num">02</span>
                <h2 class="text-title">بحث متقدم عن الأطباء</h2>
                <p>خريطة تفاعلية وقائمة ذكية للعثور على أقرب العيادات إليك حسب الاختصاص والتقييم.</p>
            </div>
            <div class="image dual-phones">
                <PhoneMockup src="/images/raw/map.png" alt="البحث بالخريطة" className="phone-back" />
                <PhoneMockup src="/images/raw/search_list.png" alt="نتائج البحث" className="phone-front" />
            </div>
        </div>
    </div>

    <!-- 3. Doctor Profile (Dual: Top + Details) -->
    <div class="feature-item fade-up">
        <div class="container feature-grid">
            <div class="text">
                <span class="step-num">03</span>
                <h2 class="text-title">ملفات أطباء موثقة</h2>
                <p>تعرف على مؤهلات الطبيب، الخدمات التي يقدمها، وأوقات الدوام قبل الحجز. شفافية كاملة.</p>
            </div>
            <div class="image dual-phones">
                <PhoneMockup src="/images/raw/doctor_details.png" alt="تفاصيل الطبيب" className="phone-back" />
                <PhoneMockup src="/images/raw/doctor_profile.png" alt="بروفايل الطبيب" className="phone-front" />
            </div>
        </div>
    </div>

    <!-- 4. Booking (Dual: Step 2 + Confirmation) -->
    <div class="feature-item alt-bg fade-up">
        <div class="container feature-grid reverse">
            <div class="text">
                <span class="step-num">04</span>
                <h2 class="text-title">حجز فوري ومؤكد</h2>
                <p>اختر الموعد المناسب واحجزه بضغطة زر مع تأكيد فوري ومزامنة مع تقويمك.</p>
            </div>
            <div class="image dual-phones">
                <PhoneMockup src="/images/raw/booking_1.png" alt="خطوات الحجز" className="phone-back" />
                <PhoneMockup src="/images/raw/booking_2.png" alt="تأكيد الحجز" className="phone-front" />
            </div>
        </div>
    </div>

    <!-- 5. Chat & Inbox (Dual) -->
    <div class="feature-item fade-up">
        <div class="container feature-grid">
            <div class="text">
                <span class="step-num">05</span>
                <h2 class="text-title">تواصل مباشر وآمن</h2>
                <p>قناة تواصل آمنة مع طبيبك. أرسل استفساراتك، صور التحاليل، أو الملاحظات الصوتية.</p>
            </div>
            <div class="image dual-phones">
                <PhoneMockup src="/images/raw/inbox.png" alt="صندوق الرسائل" className="phone-back" />
                <PhoneMockup src="/images/raw/chat.png" alt="المحادثة" className="phone-front" />
            </div>
        </div>
    </div>

    <!-- 6. Family Management -->
    <div class="feature-item alt-bg fade-up">
        <div class="container feature-grid reverse">
            <div class="text">
                <span class="step-num">06</span>
                <h2 class="text-title">إدارة صحة العائلة</h2>
                <p>أضف أفراد عائلتك إلى حسابك وقم بإدارة مواعيدهم وملفاتهم الطبية بكل سهولة.</p>
            </div>
            <div class="image">
                <PhoneMockup src="/images/raw/family.png" alt="إدارة العائلة" />
            </div>
        </div>
    </div>
    
    <!-- 7. Medical Reports (Dual: List + Detail) -->
    <div class="feature-item fade-up">
        <div class="container feature-grid">
            <div class="text">
                <span class="step-num">07</span>
                <h2 class="text-title">أرشيف التقارير الطبية</h2>
                <p>سجل كامل لزياراتك وتقاريرك الطبية. لا داعي للقلق من ضياع الأوراق بعد اليوم.</p>
            </div>
            <div class="image dual-phones">
                <PhoneMockup src="/images/raw/reports.png" alt="أرشيف التقارير" className="phone-back" />
                <PhoneMockup src="/images/raw/report_detail.png" alt="تفاصيل التقرير" className="phone-front" />
            </div>
        </div>
    </div>

    <!-- 8. Health Wallet -->
    <div class="feature-item alt-bg fade-up">
        <div class="container feature-grid reverse">
            <div class="text">
                <span class="step-num">08</span>
                <h2 class="text-title">ملفك الصحي المتكامل</h2>
                <p>الوصول السريع لبياناتك الحيوية، الحساسيات، والأمراض المزمنة. ملفك الطبي، في جيبك دائماً.</p>
            </div>
            <div class="image">
                <PhoneMockup src="/images/raw/health.png" alt="المحفظة الصحية" />
            </div>
        </div>
    </div>

</section>

<script>
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.2 });

    document.querySelectorAll('.fade-up').forEach((el) => observer.observe(el));
</script>

<style>
    .feature-item {
        padding: 100px 0;
        border-bottom: 1px solid #FAF9F8;
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 0.8s, transform 0.8s;
        overflow: hidden; /* Prevent horizontal scroll from overlapping phones */
    }

    .feature-item.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .alt-bg { background: white; }
    .feature-item:nth-child(odd) { background: #FAFAFA; }

    .feature-grid {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        align-items: center;
        gap: 80px;
    }

    .reverse { direction: ltr; }
    .reverse .text { direction: rtl; }

    .step-num {
        display: block;
        font-family: var(--font-en);
        font-size: clamp(3rem, 5vw, 5rem);
        font-weight: 900;
        color: var(--c-sand);
        opacity: 0.4;
        line-height: 1;
        margin-bottom: -10px;
    }

    .text h2 { margin-bottom: 20px; color: var(--c-main-dark); }
    .text p { color: var(--c-text-muted); max-width: 480px; }

    .image {
        display: flex;
        justify-content: center;
        position: relative;
        /* SCALING FIX: Center single phones and scale them down */
    }

    /* Target direct PhoneMockup children of .image (Single Phones) */
    .image > :global(.mockup-wrapper) {
        transform: scale(0.5);
        transform-origin: center center;
        /* Negative margins to compensate for the whitespace around the scaled element if needed, 
           but width constraint on parent usually works better. */
    }

    /* Dual Phones Layout */
    .dual-phones {
        position: relative;
        height: 650px; /* Space for stacking */
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        
        /* SCALING FIX for Dual Phones: 
           Scale the entire container's contents or the container itself. 
           Let's scale the internal items to maintain the container's layout flow.
        */
    }
    
    /* Apply 0.5 scale to the phones inside dual-phones container */
    .dual-phones :global(.mockup-wrapper) {
        /* This will be combined with specific transforms below */
    }

    /* Target specific mockups via global class injection or deeply nested style if scoping permits, 
       but Astro scopes styles by default. We passed `className` prop to PhoneMockup 
       wrapper div. */
       
    :global(.phone-back) {
        position: absolute !important;
        /* Original: scale(0.85). New: 0.85 * 0.5 = 0.425 */
        transform: scale(0.425) translateX(-160px) translateY(-40px);
        opacity: 0.6;
        filter: blur(1px);
        z-index: 1;
        transition: all 0.5s ease-out;
    }

    :global(.phone-front) {
        position: relative !important;
        z-index: 2;
        /* Original: translateX(40px). New: + scale(0.5) */
        transform: scale(0.5) translateX(80px); /* Doubled translate to match new scale */
        box-shadow: -20px 20px 60px rgba(0,0,0,0.2);
        border-radius: 56px !important; /* Updated radius 56px matched */
    }
    
    /* Hover Effect */
    .feature-item:hover :global(.phone-back) {
        /* Original: scale(0.9). New: 0.45 */
        transform: scale(0.45) translateX(-240px);
        opacity: 1;
        filter: blur(0);
    }

    @media (max-width: 900px) {
        .feature-grid { grid-template-columns: 1fr; text-align: center; gap: 40px; }
        .reverse { direction: rtl; }
        .text p { margin: 0 auto; }
        
        .dual-phones { height: 500px; transform: scale(0.8); }
        :global(.phone-back) { display: none; /* Hide back phone on mobile to convert space */ }
        :global(.phone-front) { transform: none; }
    }
</style>
